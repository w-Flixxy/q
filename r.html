<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sigma Sooper Duper Shooter</title>
    <style>
        /* CSS-reset en body-stijlen */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #111;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            user-select: none;
        }
        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #222;
            border: 2px solid #444;
        }
        #overlay {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-size: 18px;
        }
        #overlay div {
            margin: 5px 0;
        }
        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #fff;
            font-size: 32px;
            display: none;
        }
        #gameOverScreen button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background: #ff4444;
            border: none;
            color: #fff;
            border-radius: 4px;
        }
        #gameOverScreen button:hover {
            background: #ff2222;
        }
    </style>
</head>
<body>
    <!-- Canvas waarin de game getekend wordt -->
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <!-- Overlay voor score, levens, level -->
    <div id="overlay">
        <div>Score: <span id="score">0</span></div>
        <div>Levens: <span id="lives">3</span></div>
        <div>Level: <span id="level">1</span></div>
    </div>

    <!-- Game-over scherm -->
    <div id="gameOverScreen">
        <div>GAME OVER</div>
        <div>Eindscore: <span id="finalScore">0</span></div>
        <button id="restartBtn">Opnieuw Spelen</button>
    </div>

    <script>
    // ============================
    // Spelvariabelen en instellingen
    // ============================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const overlayScore = document.getElementById('score');
    const overlayLives = document.getElementById('lives');
    const overlayLevel = document.getElementById('level');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const finalScoreText = document.getElementById('finalScore');
    const restartBtn = document.getElementById('restartBtn');

    const canvasWidth = canvas.width;
    const canvasHeight = canvas.height;

    let keysPressed = {};

    // Spelerobject
    const player = {
        x: canvasWidth / 2,
        y: canvasHeight - 60,
        width: 40,
        height: 40,
        speed: 4,
        color: '#00ccff',
        lives: 3,
        invincible: false,
        invincibleTimer: 0
    };

    // Schoten van de speler
    const bullets = [];

    // Vijanden
    let enemies = [];
    let enemySpawnInterval = 2000; // in ms
    let lastEnemySpawn = 0;
    let enemiesPerWave = 5;
    let enemiesSpawnedThisWave = 0;
    let waveCleared = false;

    // Projectielen van vijanden (optioneel: maak het complexer)
    const enemyBullets = [];

    // Score en level
    let score = 0;
    let level = 1;

    let gameOver = false;

    // ============================
    // Hulpfuncties
    // ============================
    function drawRect(obj) {
        ctx.fillStyle = obj.color;
        ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
    }

    function drawCircle(obj) {
        ctx.fillStyle = obj.color;
        ctx.beginPath();
        ctx.arc(obj.x, obj.y, obj.radius, 0, Math.PI * 2);
        ctx.closePath();
        ctx.fill();
    }

    function detectCollision(a, b) {
        // AABB-collision: rechthoek vs rechthoek
        return (
            a.x < b.x + b.width &&
            a.x + a.width > b.x &&
            a.y < b.y + b.height &&
            a.y + a.height > b.y
        );
    }

    // ============================
    // Spelerbesturing
    // ============================
    document.addEventListener('keydown', (e) => {
        keysPressed[e.key] = true;
    });
    document.addEventListener('keyup', (e) => {
        keysPressed[e.key] = false;
    });

    function movePlayer() {
        if (keysPressed['ArrowLeft'] || keysPressed['a'] || keysPressed['A']) {
            player.x -= player.speed;
        }
        if (keysPressed['ArrowRight'] || keysPressed['d'] || keysPressed['D']) {
            player.x += player.speed;
        }
        if (keysPressed['ArrowUp'] || keysPressed['w'] || keysPressed['W']) {
            player.y -= player.speed;
        }
        if (keysPressed['ArrowDown'] || keysPressed['s'] || keysPressed['S']) {
            player.y += player.speed;
        }
        // Beperk speler binnen canvas
        if (player.x < 0) player.x = 0;
        if (player.x + player.width > canvasWidth) player.x = canvasWidth - player.width;
        if (player.y < 0) player.y = 0;
        if (player.y + player.height > canvasHeight) player.y = canvasHeight - player.height;
    }

    // ============================
    // Schieten door speler
    // ============================
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            e.preventDefault(); // voorkomt scrollen
            shootBullet();
        }
    });

    function shootBullet() {
        // Beperk aantal schoten tegelijk indien gewenst
        bullets.push({
            x: player.x + player.width / 2 - 5,
            y: player.y,
            width: 10,
            height: 20,
            speed: 7,
            color: '#ffff66'
        });
    }

    function updateBullets() {
        for (let i = bullets.length - 1; i >= 0; i--) {
            const b = bullets[i];
            b.y -= b.speed;
            // Verwijder schot als het boven canvas uitgaat
            if (b.y + b.height < 0) {
                bullets.splice(i, 1);
                continue;
            }
            drawRect(b);
        }
    }

    // ============================
    // Vijanden spawnen en updaten
    // ============================
    function spawnEnemy() {
        const width = 40;
        const height = 40;
        const x = Math.random() * (canvasWidth - width);
        const y = -height; // spawn net buiten top
        const speed = 1 + Math.random() * 1.5 + level * 0.2;
        const color = '#ff4444';
        enemies.push({ x, y, width, height, speed, color });
    }

    function updateEnemies(deltaTime) {
        // Spawn logic
        if (!waveCleared && Date.now() - lastEnemySpawn > enemySpawnInterval && enemiesSpawnedThisWave < enemiesPerWave) {
            spawnEnemy();
            enemiesSpawnedThisWave++;
            lastEnemySpawn = Date.now();
        }
        // Als alle vijanden zijn gespawned en geen vijanden meer bestaan => wave voorbij
        if (enemiesSpawnedThisWave >= enemiesPerWave && enemies.length === 0) {
            waveCleared = true;
        }
        // Als wave voorbij, ga naar volgend level
        if (waveCleared) {
            level++;
            overlayLevel.textContent = level;
            enemiesPerWave += 2; // meer vijanden per wave
            enemiesSpawnedThisWave = 0;
            lastEnemySpawn = 0;
            waveCleared = false;
        }
        // Update en teken elke vijand
        for (let i = enemies.length - 1; i >= 0; i--) {
            const e = enemies[i];
            e.y += e.speed;
            drawRect(e);
            // Check botsing met speler
            if (!player.invincible) {
                if (detectCollision(player, e)) {
                    handlePlayerHit();
                    enemies.splice(i, 1);
                    continue;
                }
            }
            // Als vijand onderkant canvas bereikt => speler raakt gewond en vijand verdwijnt
            if (e.y > canvasHeight) {
                handlePlayerHit();
                enemies.splice(i, 1);
                continue;
            }
            // Check botsing met elke kogel van speler
            for (let j = bullets.length - 1; j >= 0; j--) {
                const b = bullets[j];
                if (detectCollision(b, e)) {
                    // Verwijder vijand en kogel, verhoog score
                    enemies.splice(i, 1);
                    bullets.splice(j, 1);
                    score += 10;
                    overlayScore.textContent = score;
                    break;
                }
            }
        }
    }

    // ============================
    // Speler raakt gewond
    // ============================
    function handlePlayerHit() {
        player.lives--;
        overlayLives.textContent = player.lives;
        player.invincible = true;
        player.invincibleTimer = Date.now();
        if (player.lives <= 0) {
            endGame();
        }
    }

    // ============================
    // Teken speler (met korte flits bij schade)
    // ============================
    function drawPlayer() {
        if (player.invincible) {
            const elapsed = Date.now() - player.invincibleTimer;
            // Blijf 2 seconden onkwetsbaar, met flitsend effect
            if (elapsed < 2000) {
                if (Math.floor(elapsed / 100) % 2 === 0) {
                    // knipperen: niet tekenen
                    return;
                }
            } else {
                player.invincible = false;
            }
        }
        drawRect(player);
    }

    // ============================
    // Game-over logica
    // ============================
    function endGame() {
        gameOver = true;
        finalScoreText.textContent = score;
        gameOverScreen.style.display = 'flex';
    }

    restartBtn.addEventListener('click', () => {
        // Reset alle variabelen
        player.x = canvasWidth / 2;
        player.y = canvasHeight - 60;
        player.lives = 3;
        overlayLives.textContent = player.lives;
        bullets.length = 0;
        enemies.length = 0;
        score = 0;
        level = 1;
        enemiesPerWave = 5;
        enemiesSpawnedThisWave = 0;
        waveCleared = false;
        overlayScore.textContent = score;
        overlayLevel.textContent = level;
        lastEnemySpawn = 0;
        gameOver = false;
        player.invincible = false;
        gameOverScreen.style.display = 'none';
        animate(0);
    });

    // ============================
    // Hoofdlus: animatie en updaten
    // ============================
    let lastTime = 0;
    function animate(timestamp) {
        if (gameOver) return;
        const deltaTime = timestamp - lastTime;
        lastTime = timestamp;

        // Canvas leegmaken
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);

        // Updaten
        movePlayer();
        drawPlayer();
        updateBullets();
        updateEnemies(deltaTime);

        requestAnimationFrame(animate);
    }

    // Start de game-loop
    animate(0);

    </script>
</body>
</html>
